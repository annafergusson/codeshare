<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>codeshare demo</title>

<script src="index_files/header-attrs-2.5/header-attrs.js"></script>
<script src="index_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<link href="index_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="index_files/highlightjs-9.12.0/highlight.js"></script>
<script src="https://cdn.opencpu.org/opencpu-0.4.js"></script>
<script src="https://statistics-is-awesome.org/iNZightR/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>"

<script>
  // line below is need for CORS
// outside of R-based app
//ocpu.seturl("https://cloud.opencpu.org/ocpu/apps/annafergusson/codeshare/R")

$(function() {
    $(".title").after("<button id='so'>Start over</button>");
    $("h3").each(function(index){
    $(this).parent().before('<button class="next">Next</button>');
    })
    
        $(".level2").height(function (index, height) {
    return (height + 200);
});
    
    //hide for reveal later
    $(".level2").css("display","none");
    $(".level3").css("display","none");
    $(".next").css("display","none");
    
    // need better default - like check for anchor?
    $(".level2").first().css( "display", "");
    $(".next").first().css( "display", "");
    
    $(".next").click(function(){
      
      //add extra height to level2 div so can scroll
    $(".level2").height(function (index, height) {
    return (height + 100);
});

    $('html,body').animate({scrollTop: $(this).offset().top}, 500);
      $(this).next().css("display","").next().css("display","");
      $(this).css("display","none");
      $(this).removeClass("next");
    })
    
    $("#so").click(function(){
       window.location.reload(true);
    })
    
    //code stuff
   var editor;
   $('.code-exercise').each(function(index) {
     $(this).before("<button class='org' id='" + index + "'>Start over</button><button class='code' id='" + index + "'>Run code</button><img class='loading' style='display:none' id='" + index + "' src='mini-cat.gif' />")
     $(this).after("<div class='code-output'></div>");
     //stash original code in data
     $(this).data("org-code", $(this).text());
     editor = ace.edit(this);
     //editor.setTheme("ace/theme/github");
     editor.getSession().setMode("ace/mode/r");
     editor.setFontSize("14px");
     editor.getSession().setUseWrapMode(true);
     editor.setOptions({maxLines: Infinity});
     editor.setHighlightActiveLine(false);
     editor.setShowPrintMargin(false);
     editor.setShowFoldWidgets(false);
     editor.setBehavioursEnabled(true);
     editor.renderer.setDisplayIndentGuides(false);
     editor.session.getSelection().clearSelection();
     editor.session.insert({row: editor.session.getLength(),col: 0}, "\n");
   });

  //when the "run code" button is clicked
  $(".code").click(function(){
       var id = $(this).attr("id");
       //disable this button
       $(this).prop('disabled', true);
       $('.loading:eq(' + id + ')').show();
       $('.code-exercise:eq(' + id + ')').each(function(index) {
      $(this).css("opacity",0.6);
     // $('.code-output:eq(' + id + ')').html("");
       editor = ace.edit(this);
       var codeText = editor.getSession().getValue();
       var rmdText = "```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=5}\n" + codeText + "\n```";
       renderRmd(rmdText, id);
       })
    })
    
  $(".org").click(function(){
       var id = $(this).attr("id");
       $('.code-exercise:eq(' + id + ')').each(function(index) {
        editor = ace.edit(this);
        var org_code = $(this).data("org-code");
        editor.setValue(org_code);
        editor.session.getSelection().clearSelection();
        editor.session.insert({row: editor.session.getLength(),col: 0}, "\n");
       })
    })
    
  function renderRmd(textCode, id){
   var req = ocpu.call("rmdtext", {
      text : textCode
    }, function(session){
    $.get(session.getFileURL("output.html"),            function( data) {
    $('.code-output:eq(' + id + ')').html("");
    $('.code-output:eq(' + id + ')').html(data);     // make any HTML tables interactive
    $('.code-output:eq(' + id + ') > .kable-table > table').DataTable();
        })    
         $('.code:eq(' + id + ')').prop('disabled', false);
         $('.loading:eq(' + id + ')').hide();
         $('.code-exercise:eq(' + id + ')').css("opacity", 1);
         $('html,body').animate({scrollTop: $('.code-output:eq(' + id + ')').offset().top}, 500);
    }).fail(function(text){
      alert("Error: " + req.responseText);
       $('.code:eq(' + id + ')').prop('disabled', false);
       $('.loading:eq(' + id + ')').hide();
       $('.code-exercise:eq(' + id + ')').css("opacity", 1);
    });
   
  }  
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">codeshare demo</h1>

</div>


<div id="google-trends" class="section level2 progressive">
<h2 class="progressive">Google trends</h2>
<p>In this lab, you will learn how to make informative time series plots using the <a href="https://www.theta.co.nz/news-blogs/tech-blog/what-is-r/" target="blank">programming language R</a> and <a href="https://trends.google.com/trends/" target="blank">Google Trends</a> data.</p>
<div id="google-eats" class="section level3">
<h3>Google eats?</h3>
<p>Watch this short video about how you can use Google to find recipes for different foods!</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/IsUN1dUbbM8" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
</div>
<div id="how-do-google-search-trends-compare-between-different-countries" class="section level3">
<h3>How do Google search trends compare between different countries?</h3>
<p>We can use data from <a href="https://trends.google.com/trends/" target="blank">Google Trends</a> to explore when people googled for different food items.</p>
<p>Below is a plot embedded from Google Trends, showing search interest <strong>within NZ</strong> for tomatoes across the last five years. It’s interactive, so you can move your mouse/cursor over the graph and read information about each data point.</p>
<script type="text/javascript" src="https://ssl.gstatic.com/trends_nrtr/2213_RC01/embed_loader.js"></script>
<script type="text/javascript"> trends.embed.renderExploreWidget("TIMESERIES", {"comparisonItem":[{"keyword":"tomato","geo":"NZ","time":"today 5-y"}],"category":0,"property":""}, {"exploreQuery":"date=today%205-y&geo=NZ&q=tomato","guestPath":"https://trends.google.com:443/trends/embed/"}); </script>
<p>The plot show seasonality (a repeating pattern, in this case one that repeats every 12 months), where search interest for tomatoes in NZ peaks around the start of each year (our summer).</p>
</div>
<div id="can-we-recreate-this-plot-with-code" class="section level3">
<h3>Can we recreate this plot with code?</h3>
<p>We can get the Google Trends data about different search words using a R package called <code>{gtrendsR}</code>. A package is a collection of R code functions that someone else has written that we can use to do awesome things!</p>
<blockquote>
<p>Run the code below. Then change the geo (country) from “NZ” to “US”, and run the code again.</p>
</blockquote>
<pre class="r code-exercise"><code>data &lt;- gtrends(keyword = &quot;tomato&quot;,
                geo = &quot;NZ&quot;)

trend_data &lt;- data$interest_over_time %&gt;%
  mutate(date = as.Date(date),
         hits = as.numeric(hits))
  
trend_data %&gt;%
  ggplot(aes(x = date, 
             y = hits)) +
  geom_line() +
  labs(x = &quot;Date (weekly)&quot;,
       y = &quot;Search interest&quot;)</code></pre>
</div>
<div id="more-with-plots" class="section level3">
<h3>More with plots</h3>
<p>Another query - just to check code boxes run independently.</p>
<pre class="r code-exercise"><code>data &lt;- gtrends(keyword = &quot;flu&quot;,
                geo = &quot;NZ&quot;)

trend_data &lt;- data$interest_over_time %&gt;%
  mutate(date = as.Date(date),
         hits = as.numeric(hits))
  
trend_data %&gt;%
  ggplot(aes(x = date, 
             y = hits)) +
  geom_line() +
  labs(x = &quot;Date (weekly)&quot;,
       y = &quot;Search interest&quot;)</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
